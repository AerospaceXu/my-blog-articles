# 编程前该做些什么

对于程序而言，我们首先需要思考的就是**功能逻辑该如何进行拆分？**

但是我想先放一放，让我们从**产品的角度**首先切入——毕竟程序最终还是为了产品而服务（某些方面）。

**在宏观上，我们应该如何拆分一个应用呢？**

首先是用户流程图。

- 用户第一打开应用看到什么？发生什么？
- 点击按钮之后又该发生什么？
- 页面之间以何种逻辑进行切换？
- ……

也就是说，这其实就是使用流程图表示出来用户的操作顺序与程序的状态，清晰明了。（_这是产品经理该干的事情，如果没给你一定得要过来_）

然后是交互图，描述对象之间的关系以及对象之间的信息传递，包括顺序、时序、通讯、概览。

其实图是其次，不同的应用方向有不同的画图标准，甚至每家公司都不一样，只要意思到位即可。画图只是辅助，你要是能不画图就能想清楚，也可以不画。

只是画图是为了强制我们想清楚这部分问题，没想清楚当然也可以先下手写代码。但是没有想清楚逻辑就下手是非常危险的一件事情！

**问题在开始处暴露永远比在开发过程中暴露容易结局。**

## 五大操作

我们进行以下分析：

1. 抓主体：活动的发起者是谁？该活动会对谁造成影响？
2. 抓流程：流程会经过哪些节点？错误如何处理？如果优化一下，能否让它有更好的体验？
3. 抓通讯：流程涉及哪些节点的通讯有哪些？如何通讯？
4. 抓中间状态：应该用什么样的数据结构，表征存储这些通讯和流程？
5. 抓边界：了解这次活动的边界在哪里，如果才能做到封装？

好了，接下来我们一步一步来。

### 抓主体：哪些节点参与了这次活动？

产品会告诉你，用户通过了哪个按钮，操作，然后影响了哪些页面。

找到了这些主题，你就能明白这次逻辑大概会在哪个范围内发生。

比如：

- xxx 模块参与了活动，是不是要变更 xxxService ？
- 影响了 A 组件，是否需要改变 yyyService？

抓流程：途中经历了：PerformTests，ProcessResults，NotifyClinician，Supervisor contact Clinician 四个节点，这些节点是名词还是动词还是短语？

名词的话，有没有相关组件或者模块？

没有的话就创建，有的话，看看在哪里埋下交互点和逻辑处理比较合适？

动词或者短语的话，是不是需要进行逻辑处理？该设计怎样的处理管道？这个流程够不够细致？（细致的话，中间结点没有动词和短语，只有名词）

不够，询问产品，把问题搞清楚比如：Notify Clinician ？ getMessage -> request -> checkIfEnableRequest -> NoticeSupervisor?

### 抓通讯

- 那些地方存在交互？
- 这个交互是本地的还是跨平台的（后端接口）？
- 能不能缩减一部分？（比如用户数据是在登入系统即会获取的）
- 通讯需不需要重新尝试或者有其他什么逻辑？（rxjs retry 或者 ahooks useDebounce？有些时候这部分产品不会详写）
- 通讯的格式是怎样的的？（问问后端？或者设计 grapql query）
- 一个 Notice SuperVisor 啥意思 ？
- 是发邮件还是页面解决？

页面解决的话，显示结果的地方在哪里？

### 抓中间状态

明确了主体，流程，和通讯，需要思考用什么样的状态格式来进行存储，方便调试和重构。

重点分析那些箭头，怎么样用数据表征这些箭头，同时还需要知会后端（devApi，swagger 等）有没有统一通讯功能？可以直接复用？

比如：request LabRequest ， request Stat，Notice SuperVisor ，开始和结束是否需要同一个结构？

```json
{
  "name": "lab request",
  "status": "stat request",
  "handler": "xxx"
}
```

诸如此类？

### 抓边界

好了，最后仔细思考，要在哪些文件变更，依赖应该放置于哪些层级，之前的依赖要不要动手进行提升？

这部分 labModule 和 supervisorModule 都用到了，之前 labService 在 labModule 上，我现在需要提升到 appModuleokay，移动文件夹，修改注入点接下来，就是一阵操作猛如虎，一个模块一个模块实现~

**分治是 DDD 的核心，**也是编程的核心。

我以为最好的分治状态就是：状态、逻辑、资源（图片、音/视频）、配置项……一起分治。甚至有极端一点的开发者会认为需要，分开开发，分开测试，分开重构，甚至分开部署。
