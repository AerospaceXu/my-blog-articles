# 说说跨域

本文写于 2020 年 6 月 17 日

大家有被盗号的经历吗？

就是那种，对盗来的号的每个好友发送一遍：“xxx，在吗？借我 200 块钱，江湖救急！”

这是多恐怖的事情。

假设你登录了网页版 QQ，我们知道所有的数据其实都是 JS 请求服务器得来的。那如果我写一个“黑客网站”，你只要打开我的网站，我就会请求 QQ 的服务器，以得到你的 QQ 数据，这样就能像每一个好友借一边钱（嘿嘿嘿）。

如果这一切成真，该多么恐怖？

**但实际上这是不行的。**因为浏览器拥有 **「同源」** 策略。

## 同源是什么？

浏览器安全的基石就是“同源政策”。

1995 年，同源政策由网景引入了浏览器。并且到目前为止，**所有浏览器都**实行这个政策。

最初它的含义是指，**A 网页设置的 Cookie，B 网页不能打开，除非这两个网页"同源"**。

这里所谓的“同源”指的是三个相同：

1. 协议相同
2. 域名相同
3. 端口相同

这三个在我之前一篇文章中讲过，都是 URL 的几个部分。

比如说 `https://www.baidu.com:8080` 中，`https://` 就是协议，`www.baidu.com` 就是域名，`:8080` 就是端口号。这三个必须严格相同，否则浏览器将视为**不同源**。

举几个例子：

- `baidu.com` 和 `www.baidu.com` 不同源（域名不同）
- `www.baidu.com/s` 和 `www.baidu.com` 同源
- `http://www.baidu.com:8080` 和 `https://www.baidu.com:8080` 不同源（协议不同）
- `baidu.com:8080` 和 `baidu.com:80` 不同源（端口不同）

**不同源好不好？**

刚刚说了黑客网页可以偷走你正在访问的网页的一些数据，甚至进行一些操作。这是怎么做的呢？

其实就是 Cookie。所谓 Cookie 就是“小型文本文件”，是网站为了辨别用户身份而储存在浏览器本地上的数据。

如果她包含了某些隐私信息，比如支付宝余额，让黑客网站随便就拿到了，对用户隐私将会是极大的损害。

甚至于 Cookie 有时会保存登录信息，如果没有「同源策略」，黑客网站就能像文章开头所说的那样，直接操作你的账户！

现在，随着互联网的发展，"同源政策"越来越严格。**目前如果不是同源，共有三种行为受到限制：**

1. Cookie, LocalStorage, IndexDB 无法读取；
2. DOM 无法获得；
3. AJAX 请求不能发送。

那我真的需要操作这些怎么办呢？比如两个网站有某些合作，甚至说这俩网站本来就都是我的，我该怎么办？

## 跨域

这就需要用到**跨域**了。

先看看维基百科的解释：

> 跨域资源共享，用于让网页的受限资源能够被其他域名的页面访问的一种机制。
>
> 通过该机制，页面能够自由地使用不同源的图片、样式、脚本、iframes 以及视频。
>
> 一些跨域的请求常常会被同源策略所禁止的。
>
> 跨源资源共享定义了一种方式，为的是浏览器和服务器之间能互相确认是否足够安全以至于能使用跨源请求

### 1. CORS

跨域有许多种方法，先说最常见也是比较新的一种方式：**CORS**。

CORS 是一个需要浏览器和服务器同时支持的技术。
